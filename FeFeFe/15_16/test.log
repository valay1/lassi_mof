#INFO: **** input file is /project/lgagliardi/valayagarawal/lasscf/mof_nodes/Fe_Fe_Fe/production/15_16/lassi.py ****
import numpy as np
import sys
from pyscf import gto, scf, tools,lib, mcscf
from pyscf.mcscf import avas,project_init_guess
from pyscf import mcscf
from mrh.my_pyscf.tools import molden
from mrh.my_pyscf.mcscf import lasscf_async as asyn
mol_name='Fe_Fe_Fe.xyz' # Al-Fe-Fe MOF node
basis={'C': 'cc-pvdz','H': 'cc-pvdz','O': 'cc-pvtz','Al': 'cc-pvtz','Fe': 'cc-pvtz'}
output='test.log'
mol=gto.M(atom=mol_name,verbose=4,spin=14,charge=0,basis=basis, output=output) #spin = 2S
mf=scf.RHF(mol)
#mf.init_guess='atom'
mf=mf.density_fit()
mf.max_cycle=1
mf.kernel()
#mf=mf.newton()
#mf.max_cycle=1
#mf.kernel()
mf.mo_coeff=np.load('hf.npy')
#ncas,nelecas,guess_mo_coeff=avas.kernel(mf,['Fe 3d', 'Fe 4d'],minao=mol.basis, openshell_option=3)
#mc_test = mcscf.CASCI (mf, ncas, nelecas)
#final_list=[8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]+mc_test.ncore
mo_converged=np.load('las_15_16.npy')
las=asyn.LASSCF(mf,(5,5,5),((3,3),(0,5),(5,0)),spin_sub=(5,6,6),verbose=4) 
las.set_fragments_(([17],[19],[22]),mo_converged)
las.mo_coeff=mo_converged

from mrh.my_pyscf.lassi import states
from mrh.my_pyscf.mcscf.lasci import get_space_info
las=states.spin_shuffle(las)
las=states.all_single_excitations(las)
ncsf=las.get_ugg().ncsf_sub
charges, spins, smults, wfnsyms = get_space_info (las)
np.save('spins',spins)
np.save('smults',smults)
np.save('charges',charges)
exit()
lroots=np.minimum(6,ncsf)
lroots[charges.T==0] =1
las.lasci(lroots=lroots)
eroots,si=las.lassi()
#from mrh.my_pyscf.lassi.sitools import analyze
#ci1, si1, space_weights, navg, maxw, entr = analyze(las,si, state=[0,1,2,6,12,17,21,23],return_metrics=True)
#np.save('r1_n5_ct/ci1',ci1)
#np.save('r1_n5_ct/si1',si1)
#np.save('r1_n5_ct/space_weights',space_weights)
#np.save('r1_n5_ct/navg',navg)
#np.save('r1_n5_ct/maxw',maxw)
#np.save('r1_n5_ct/entr',entr)
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='midway3-0308.rcc.local', release='4.18.0-305.3.1.el8.x86_64', version='#1 SMP Tue Jun 1 16:14:33 UTC 2021', machine='x86_64')  Threads 16
Python 3.9.12 (main, Apr  5 2022, 06:56:58) 
[GCC 7.5.0]
numpy 1.21.6  scipy 1.7.3
Date: Tue Jan 16 14:38:50 2024
PySCF version 2.4.0
PySCF path  /project/lgagliardi/valayagarawal/Apps/pyscf
GIT ORIG_HEAD c876e965f3dcd23d6cf8dbb9c9085b44f22ba11e
GIT HEAD (branch master) f6b35f72c4f64b47d85ee78beccbadb18a58eee3

[ENV] PYSCF_MAX_MEMORY 256000
[ENV] PYSCF_EXT_PATH /project/lgagliardi/valayagarawal/Apps/dmrgscf:
[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 28
[INPUT] num. electrons = 224
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 14
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 O     -1.396530535900  -2.155053668200   1.497463409200 AA   -2.639060237443  -4.072461216637   2.829795724946 Bohr   0.0
[INPUT]  2 O     -1.424929947800  -0.157920218100   2.556757216000 AA   -2.692727348033  -0.298425961741   4.831570905245 Bohr   0.0
[INPUT]  3 C     -1.805663158200  -1.333357732900   2.354770590800 AA   -3.412208842215  -2.519680941252   4.449871502792 Bohr   0.0
[INPUT]  4 H     -2.611139823600  -1.698287376800   3.015172571600 AA   -4.934339139549  -3.209298022958   5.697850378625 Bohr   0.0
[INPUT]  5 O      1.422169433100  -0.172776606600  -2.448307975000 AA    2.687510731287  -0.326500467206  -4.626631541338 Bohr   0.0
[INPUT]  6 O      1.404243291500  -2.165442677100  -1.387375375500 AA    2.653635233193  -4.092093598164  -2.621759491661 Bohr   0.0
[INPUT]  7 C      1.812327532700  -1.345288486000  -2.246529163600 AA    3.424802684812  -2.542226797071  -4.245324850052 Bohr   0.0
[INPUT]  8 H      2.621336913500  -1.706173551000  -2.904090707500 AA    4.953608846728  -3.224200732367  -5.487936078069 Bohr   0.0
[INPUT]  9 O     -1.428899418000   2.343625706100   1.186473538000 AA   -2.700228559570   4.428810723019   2.242110040864 Bohr   0.0
[INPUT] 10 O     -1.403562858100  -2.165307124600  -1.387572278000 AA   -2.652349400421  -4.091837441063  -2.622131583459 Bohr   0.0
[INPUT] 11 O     -1.422998602300  -0.172362922600  -2.447964967100 AA   -2.689077633986  -0.325718717744  -4.625983350349 Bohr   0.0
[INPUT] 12 C     -1.812500488200  -1.345105901400  -2.246279413800 AA   -3.425129523338  -2.541881762182  -4.244852891331 Bohr   0.0
[INPUT] 13 H     -2.621699381200  -1.706195274400  -2.903496623700 AA   -4.954293811410  -3.224241783643  -5.486813422392 Bohr   0.0
[INPUT] 14 O      1.425112370600  -0.157194806200   2.556693752400 AA    2.693072077164  -0.297055131922   4.831450976423 Bohr   0.0
[INPUT] 15 O      1.397382094800  -2.154305542500   1.497360668900 AA    2.640669450543  -4.071047463958   2.829601573917 Bohr   0.0
[INPUT] 16 C      1.806221903800  -1.332524996000   2.354699920000 AA    3.413264718373  -2.518107296577   4.449737954335 Bohr   0.0
[INPUT] 17 H      2.611813123200  -1.697184247500   3.015110605000 AA    4.935611491393  -3.207213410701   5.697733278722 Bohr   0.0
[INPUT] 18 Fe    -0.000142986400   0.971642646100   1.624782043000 AA   -0.000270205136   1.836138492077   3.070393073381 Bohr   0.0
[INPUT] 19 O      1.428198548600   2.344050002400   1.186026051100 AA    2.698904108355   4.429612526822   2.241264413178 Bohr   0.0
[INPUT] 20 Fe    -0.000136422400   0.952927878000  -1.522872888500 AA   -0.000257800973   1.800772705883  -2.877812681790 Bohr   0.0
[INPUT] 21 O      1.423595106900   2.330128124700  -1.070103353900 AA    2.690204864312   4.403303990829  -2.022202263850 Bohr   0.0
[INPUT] 22 O     -1.423503945100   2.330456754100  -1.069656997800 AA   -2.690032593477   4.403925010392  -2.021358773066 Bohr   0.0
[INPUT] 23 Fe     0.000254998800  -1.941619777000   0.045888528400 AA    0.000481877894  -3.669129616569   0.086716750935 Bohr   0.0
[INPUT] 24 O     -0.000152138200  -0.071914987500   0.072147896200 AA   -0.000287499531  -0.135899630627   0.136339764282 Bohr   0.0
[INPUT] 25 C      1.815220274200   2.721515147600   0.054422244100 AA    3.430269173996   5.142918272819   0.102843136433 Bohr   0.0
[INPUT] 26 H      2.604057214900   3.492625268800   0.048831474800 AA    4.920954948859   6.600105213767   0.092278113631 Bohr   0.0
[INPUT] 27 C     -1.815568952400   2.721425035400   0.054846494400 AA   -3.430928080300   5.142747985441   0.103644853308 Bohr   0.0
[INPUT] 28 H     -2.604489027400   3.492449071900   0.049250759800 AA   -4.921770956221   6.599772249882   0.093070447449 Bohr   0.0

nuclear repulsion = 3848.37097509846
number of shells = 192
number of NR pGTOs = 1137
number of NR cGTOs = 708
basis = {'C': 'cc-pvdz', 'H': 'cc-pvdz', 'O': 'cc-pvtz', 'Al': 'cc-pvtz', 'Fe': 'cc-pvtz'}
ecp = {}
CPU time:         1.76


******** <class 'pyscf.df.df_jk.DFROHF'> ********
method = DFROHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 1
direct_scf = False
chkfile to save SCF result = /project/lgagliardi/valayagarawal/scratch/tmp4oromg42
max_memory 256000 MB (current use 84 MB)
num. doubly occ = 105  num. singly occ = 14
Set gradient conv threshold to 3.16228e-05
******** <class 'pyscf.df.df.DF'> ********
auxbasis = None
max_memory = 256000
Even tempered Gaussians are generated as DF auxbasis for  H O Fe C
init E= -4989.57211323766
  HOMO = 0.143847996496208  LUMO = 0.151053031442405
cycle= 1 E= -4950.11181863296  delta_E= 39.5  |g|=   11  |ddm|= 94.9
SCF not converged.
SCF energy = -4950.11181863296
Built 23 spin(local Sz)-shuffled LAS states from 1 reference LAS states
Built 158 singly-excited LAS states from 24 reference LAS states
